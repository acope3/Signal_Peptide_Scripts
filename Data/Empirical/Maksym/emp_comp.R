library(plyr)

df <- read.table("samples_1_6.csv",sep=",",header=T)
df.2 <- read.table("samples_7_22.csv",sep=",",header=T)
au <- read.table("../trans_eff_main_ht.csv",sep=",",header=T)
df <- join(df,df.2,by="Gene")
df.au <- sapply(df[,2:23],function(i){i * au[,2]})
phi <- read.table("../main_ht/gene_expression_liberal.txt",sep="",header=F)

li <- read.table("../main_ht/mRNA_level_main_ht_liberal.csv",sep=",",header=T)
#cho <- read.table("../GSE67218/mRNA_level.csv",sep=",",header=T)

pp <- c()
ps <- c()
pdf("all_possible_comp_mrna_abundance.pdf")
for (i in 2:(ncol(df)-1))
{
  for (j in (i+1):ncol(df))
  {
  x <- which(df[,i] != 0)
  y <- which(df[,j] !=0 )
  z <- intersect(x,y)
  plot(log10(df[z,i]),log10(df[z,j]),main=bquote("Sample " ~ .(i-1) ~" vs Sample " ~ .(j-1)),xlab=bquote("Sample " ~ .(i-1) ~ ", log10(mRNA abundance)"),ylab=bquote("Sample " ~ .(j-1) ~ ", log10(mRNA abundance)"))
  rho.p <- cor(log10(df[z,i]),log10(df[z,j]))
  rho.s <- cor(log10(df[z,i]),log10(df[z,j]),method="spearman")
  xlim <- c(min(log10(df[z,i])),max(log10(df[z,i])))
  ylim <- c(min(log10(df[z,j])),max(log10(df[z,j])))
  text(xlim[1]+0.5,ylim[2]-0.25,labels=bquote(rho["p"] ~ "=" ~ .(rho.p)))
  text(xlim[1]+0.5,ylim[2]-0.5,labels=bquote(rho["s"] ~ "=" ~ .(rho.s)))
  pp <- c(pp,rho.p)
  ps <- c(ps,rho.s)
  }
}
hist(x = pp,nclass = 15,main = "Pearson Correlation Coefficients\nAccession GSE45443",xlab="Pearson correlation coefficient")
hist(x = ps,nclass = 15,main = "Spearman Correlation Coefficients\nAccession GSE45443",xlab="Spearman correlation coefficient")
dev.off()

pp <- c()
ps <- c()
pdf("GSE45443_mrna_comparisons_to_phi.pdf")
for (i in 2:ncol(df))
{
  x <- which(df[,i]!=0)
  plot(log10(df[x,i]),phi[x,1],main=bquote("Sample " ~ .(i-1)),xlab="log10(mRNA Abundance)",ylab=expression("log10("*phi*")"))
  rho.p <- cor(log10(df[x,i]),phi[x,1])
  rho.s <- cor(log10(df[x,i]),phi[x,1],method="spearman")
  xlim <- c(min(log10(df[x,i])),max(log10(df[x,i])))
  ylim <- c(min(phi[x,1]),max(phi[x,1]))
  text(xlim[1]+0.5,ylim[2]-0.25,labels=bquote(rho["p"] ~ "=" ~ .(rho.p)))
  text(xlim[1]+0.5,ylim[2]-0.5,labels=bquote(rho["s"] ~ "=" ~ .(rho.s)))
  pp <- c(pp,rho.p)
  ps <- c(ps,rho.s)
}
hist(x = pp,nclass = 15,main = expression("Accession GSE45443 with "*phi),xlab="Pearson correlation coefficient")
hist(x = ps,nclass = 15,main = expression("Accession GSE45443 with "*phi),xlab="Spearman correlation coefficient")
dev.off()

# pp <- c()
# ps <- c()
# pdf("GSE45443_mrna_au_comparisons_to_phi.pdf")
# for (i in 2:ncol(df.au))
# {
#   x <- which(df.au[,i]!=0)
#   plot(log10(df.au[x,i]),phi[x,1],main=bquote("Sample " ~ .(i-1)),xlab="log10(mRNA Abundance * AU)",ylab=expression("log10("*phi*")"))
#   rho.p <- cor(log10(df.au[x,i]),phi[x,1])
#   rho.s <- cor(log10(df.au[x,i]),phi[x,1],method="spearman")
#   xlim <- c(min(log10(df.au[x,i])),max(log10(df.au[x,i])))
#   ylim <- c(min(phi[x,1]),max(phi[x,1]))
#   text(xlim[1]+0.5,ylim[2]-0.25,labels=bquote(rho["p"] ~ "=" ~ .(rho.p)))
#   text(xlim[1]+0.5,ylim[2]-0.5,labels=bquote(rho["s"] ~ "=" ~ .(rho.s)))
#   pp <- c(pp,rho.p)
#   ps <- c(ps,rho.s)
# }
# hist(x = pp,nclass = 15,main = expression("Accession GSE45443 with "*phi),xlab="Pearson correlation coefficient")
# hist(x = ps,nclass = 15,main = expression("Accession GSE45443 with "*phi),xlab="Spearman correlation coefficient")
# dev.off()


pp <- c()
ps <- c()
pdf("GSE45443_comparisons_to_lietal.pdf")
for (i in 2:ncol(df))
{
  x <- which(df[,i]!=0)
  y <- which(li[,2] != 0)
  z <- intersect(x,y)
  plot(log10(df[z,i]),log10(li[z,2]),main=bquote("Sample " ~ .(i-1) ~" vs Li et al"),xlab="log10(mRNA Abundance)",ylab="log10(mRNA abundance)")
  rho.p <- cor(log10(df[z,i]),log10(li[z,2]))
  rho.s <- cor(log10(df[z,i]),log10(li[z,2]),method="spearman")
  xlim <- c(min(log10(df[z,i])),max(log10(df[z,i])))
  ylim <- c(min(log10(li[z,2])),max(log10(li[z,2])))
  text(xlim[1]+0.5,ylim[2]-0.25,labels=bquote(rho["p"] ~ "=" ~ .(rho.p)))
  #text(xlim[1]+0.5,ylim[2]-0.5,labels=bquote(rho["s"] ~ "=" ~ .(rho.s)))
  pp <- c(pp,rho.p)
  ps <- c(ps,rho.s)
}
hist(x = pp,nclass = 15,main = "Accession GSE45443 with Li et al data",xlab="Pearson correlation coefficient")
hist(x = ps,nclass = 15,main = "Accession GSE45443 with Li et al data",xlab="Spearman correlation coefficient")
dev.off()

# pp <- c()
# ps <- c()
# pdf("GSE45443_comparisons_to_cho.pdf")
# for (i in 2:ncol(df))
# {
#   x <- which(df[,i]!=0)
#   y <- which(cho[,2] != 0)
#   z <- intersect(x,y)
#   plot(log10(df[z,i]),log10(cho[z,2]),main=bquote("Sample " ~ .(i-1) ~" vs Cho et al"),xlab="log10(mRNA Abundance)",ylab="log10(mRNA abundance)")
#   rho.p <- cor(log10(df[z,i]),log10(cho[z,2]))
#   rho.s <- cor(log10(df[z,i]),log10(cho[z,2]),method="spearman")
#   xlim <- c(min(log10(df[z,i])),max(log10(df[z,i])))
#   ylim <- c(min(log10(cho[z,2])),max(log10(cho[z,2])))
#   text(xlim[1]+0.5,ylim[2]-0.25,labels=bquote(rho["p"] ~ "=" ~ .(rho.p)))
#   text(xlim[1]+0.5,ylim[2]-0.5,labels=bquote(rho["s"] ~ "=" ~ .(rho.s)))
#   pp <- c(pp,rho.p)
#   ps <- c(ps,rho.s)
# }
# hist(x = pp,nclass = 15,main = "Accession GSE45443 with Cho data",xlab="Pearson correlation coefficient")
# hist(x = ps,nclass = 15,main = "Accession GSE45443 with Cho data",xlab="Spearman correlation coefficient")
# dev.off()


# pdf("li_cho_comparison.pdf")
# x <- which(li[,2]!=0)
# y <- which(cho[,2] != 0)
# z <- intersect(x,y)
# plot(log10(li[z,2]),log10(cho[z,2]),main="Li et al vs Cho et al",xlab="log10(mRNA Abundance)",ylab="log10(mRNA abundance)")
# rho.p <- cor(log10(li[z,2]),log10(cho[z,2]))
# rho.s <- cor(log10(li[z,2]),log10(cho[z,2]),method="spearman")
# xlim <- c(min(log10(li[z,2])),max(log10(li[z,2])))
# ylim <- c(min(log10(cho[z,2])),max(log10(cho[z,2])))
# text(xlim[1]+0.5,ylim[2]-0.25,labels=bquote(rho["p"] ~ "=" ~ .(rho.p)))
# text(xlim[1]+0.5,ylim[2]-0.5,labels=bquote(rho["s"] ~ "=" ~ .(rho.s)))
# dev.off()

